import React, { useEffect, useMemo, useRef, useState } from "react"; import { Button } from "@/components/ui/button"; import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card"; import { Input } from "@/components/ui/input"; import { Label } from "@/components/ui/label"; import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"; import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from "@/components/ui/dialog"; import { Separator } from "@/components/ui/separator"; import { Badge } from "@/components/ui/badge"; import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@/components/ui/tooltip"; import { ScrollArea } from "@/components/ui/scroll-area"; import { toast } from "sonner"; import { Plus, UserCircle2, MessageSquareText, LogIn, LogOut, ShieldCheck, Send, Rocket, Timer, Smartphone, Settings, XCircle, Bot, } from "lucide-react"; import { motion } from "framer-motion";

// NOTE: This UI is a SAFE admin panel. The action buttons call placeholder endpoints // (e.g., /api/test-payload, /api/send) that should only deliver normal, consented messages // to whitelisted numbers. Do NOT wire this to any exploit/"bug" behavior.

const brand = { name: "X-RENDERS", accent: "from-red-600 via-red-500 to-red-400", text: "text-red-600", };

function ShadowTitle({ children }: { children: React.ReactNode }) { return ( <div className="relative"> <div className="absolute -top-6 left-0 text-5xl font-black opacity-10 select-none">{brand.name}</div> <h1 className="text-2xl md:text-3xl font-extrabold tracking-tight">{children}</h1> </div> ); }

function Header({ onLogout, user }: { onLogout: () => void; user: null | { username: string } }) { return ( <div className="sticky top-0 z-30 backdrop-blur bg-white/70 dark:bg-neutral-900/70 border-b"> <div className="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between"> <div className="flex items-center gap-3"> <div className={h-9 w-9 rounded-2xl bg-gradient-to-br ${brand.accent} shadow-lg} /> <div className="leading-tight"> <div className="font-black text-lg tracking-tight">{brand.name}</div> <div className="text-xs opacity-70">Safe Admin Panel • Red Theme</div> </div> </div> <div className="flex items-center gap-2"> <Badge variant="secondary" className="rounded-xl"><ShieldCheck className="h-3 w-3 mr-1"/>Safe Mode</Badge> {user ? ( <Button variant="outline" size="sm" onClick={onLogout}><LogOut className="h-4 w-4 mr-1"/>Logout</Button> ) : null} </div> </div> </div> ); }

function LoginModal({ onLogin }: { onLogin: (u: string, p: string) => void }) { const [username, setUsername] = useState(""); const [password, setPassword] = useState(""); return ( <Dialog defaultOpen> <DialogContent className="sm:max-w-md"> <DialogHeader> <DialogTitle className="flex items-center gap-2"><LogIn className="h-5 w-5"/> Login</DialogTitle> <DialogDescription>Masuk dengan username & password untuk mengakses {brand.name}.</DialogDescription> </DialogHeader> <div className="grid gap-4 py-2"> <div className="grid gap-2"> <Label>Username</Label> <Input value={username} onChange={(e) => setUsername(e.target.value)} placeholder="xvannn"/> </div> <div className="grid gap-2"> <Label>Password</Label> <Input type="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="••••••••"/> </div> </div> <div className="flex justify-end gap-2"> <Button onClick={() => onLogin(username, password)} className="bg-gradient-to-r from-red-600 to-red-500"><LogIn className="h-4 w-4 mr-1"/>Masuk</Button> </div> </DialogContent> </Dialog> ); }

function Accounts({ items, onAdd }: { items: string[]; onAdd: (jid: string) => void }) { const [jid, setJid] = useState(""); return ( <Card className="rounded-2xl shadow-md"> <CardHeader> <CardTitle className="flex items-center gap-2"><UserCircle2 className="h-5 w-5"/> Akun Terkait</CardTitle> </CardHeader> <CardContent className="space-y-3"> <div className="flex gap-2"> <Input placeholder="62812xxxxxxx@s.whatsapp.net" value={jid} onChange={(e)=>setJid(e.target.value)} /> <Button onClick={() => { if (jid.trim()) { onAdd(jid.trim()); setJid(""); } }}><Plus className="h-4 w-4 mr-1"/>Add</Button> </div> <ScrollArea className="h-40 rounded-md border"> <div className="p-3 space-y-2"> {items.length === 0 ? <div className="text-sm opacity-70">Belum ada akun.</div> : items.map((a, i) => ( <div key={i} className="flex items-center justify-between text-sm"> <span className="truncate max-w-[70%]">{a}</span> <Badge variant="outline">Whitelisted</Badge> </div> ))} </div> </ScrollArea> </CardContent> </Card> ); }

function AIAssistant({ onSend }: { onSend: (m: string) => void }) { const [msg, setMsg] = useState(""); const [history, setHistory] = useState<{ role: "user"|"assistant"; content: string }[]>([]); const send = async () => { if (!msg.trim()) return; const m = msg.trim(); setHistory((h) => [...h, { role: "user", content: m }]); setMsg(""); try { const r = await fetch("/api/ai", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ message: m }) }); const data = await r.json(); setHistory((h) => [...h, { role: "assistant", content: data.reply || "(no reply)" }]); } catch (e) { setHistory((h) => [...h, { role: "assistant", content: "(AI error)" }]); } onSend(m); }; return ( <Card className="rounded-2xl shadow-md h-full"> <CardHeader> <CardTitle className="flex items-center gap-2"><Bot className="h-5 w-5"/> Chat AI</CardTitle> </CardHeader> <CardContent className="flex flex-col h-[420px]"> <ScrollArea className="flex-1 border rounded-md p-3"> <div className="space-y-3"> {history.map((m, i) => ( <div key={i} className={max-w-[85%] ${m.role === "user" ? "ml-auto" : ""}}> <div className={rounded-2xl px-3 py-2 text-sm shadow ${m.role === "user" ? "bg-red-600 text-white" : "bg-muted"}}> {m.content} </div> </div> ))} </div> </ScrollArea> <div className="mt-3 flex gap-2"> <Input placeholder="Tanya asisten…" value={msg} onChange={(e)=>setMsg(e.target.value)} onKeyDown={(e)=>{ if (e.key === 'Enter') send(); }} /> <Button onClick={send}><Send className="h-4 w-4 mr-1"/>Kirim</Button> </div> </CardContent> </Card> ); }

function SafeActions() { const [loading, setLoading] = useState<string | null>(null); const call = async (key: string, label: string) => { try { setLoading(key); const r = await fetch("/api/test-payload", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ kind: key }) }); const data = await r.json(); toast.success(${label} terkirim (safe), { description: data.status || "OK" }); } catch (e) { toast.error(${label} gagal); } finally { setLoading(null); } }; return ( <Card className="rounded-2xl shadow-md"> <CardHeader> <CardTitle className="flex items-center gap-2"><Settings className="h-5 w-5"/> Aksi Uji (SAFE)</CardTitle> </CardHeader> <CardContent className="grid grid-cols-1 sm:grid-cols-3 gap-3"> <TooltipProvider> <Tooltip> <TooltipTrigger asChild> <Button disabled={!!loading} onClick={() => call("test1", "Test #1")} className="h-24 rounded-2xl bg-gradient-to-tr from-red-600 to-red-500"> <Rocket className="h-5 w-5 mr-2"/> Test #1 </Button> </TooltipTrigger> <TooltipContent>Pengiriman aman ke nomor yang sudah whitelist.</TooltipContent> </Tooltip> </TooltipProvider> <Button disabled={!!loading} onClick={() => call("test2", "Test #2")} className="h-24 rounded-2xl bg-gradient-to-tr from-red-600 to-red-500"> <Timer className="h-5 w-5 mr-2"/> Test #2 </Button> <Button disabled={!!loading} onClick={() => call("test3", "Test #3")} className="h-24 rounded-2xl bg-gradient-to-tr from-red-600 to-red-500"> <Smartphone className="h-5 w-5 mr-2"/> Test #3 </Button> <div className="col-span-full text-xs opacity-70"> * Tombol di atas hanyalah simulasi aman. Tidak mengirim payload berbahaya. </div> </CardContent> </Card> ); }

export default function App() { const [user, setUser] = useState<null | { username: string }>(null); const [accounts, setAccounts] = useState<string[]>([]);

const login = async (u: string, p: string) => { try { const r = await fetch("/api/login", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ username: u, password: p }) }); if (r.ok) { setUser({ username: u }); toast.success("Login sukses"); } else { toast.error("Login gagal"); } } catch (e) { toast.error("Login error"); } };

const logout = () => setUser(null);

const addAccount = async (jid: string) => { try { const r = await fetch("/api/accounts", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ jid }) }); if (!r.ok) throw new Error("fail"); setAccounts((a) => [...a, jid]); toast.success("Akun ditambahkan (whitelist)"); } catch (e) { toast.error("Gagal tambah akun"); } };

return ( <div className="min-h-screen bg-gradient-to-b from-white to-neutral-50 dark:from-neutral-950 dark:to-neutral-900 text-sm"> <Header onLogout={logout} user={user} />

{!user && <LoginModal onLogin={login} />}

  <main className="max-w-6xl mx-auto px-4 py-6">
    <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.4 }}>
      <ShadowTitle>
        <span className="bg-clip-text text-transparent bg-gradient-to-r from-red-600 to-red-400">{brand.name}</span> —
        <span className="ml-2 opacity-80">Safe Control Center</span>
      </ShadowTitle>
      <p className="mt-2 opacity-80 max-w-2xl">Panel ini dirancang <b>aman & legal</b>: hanya untuk mengirim pesan biasa ke nomor yang sudah memberikan persetujuan (whitelist). Tidak ada fitur crash/delay/forceclose.</p>
    </motion.div>

    <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 mt-6">
      <div className="lg:col-span-2 space-y-4">
        <SafeActions />
        <AIAssistant onSend={()=>{}}/>
      </div>
      <div className="space-y-4">
        <Accounts items={accounts} onAdd={addAccount} />
        <Card className="rounded-2xl shadow-md">
          <CardHeader>
            <CardTitle className="flex items-center gap-2"><MessageSquareText className="h-5 w-5"/> Kirim Pesan</CardTitle>
          </CardHeader>
          <CardContent className="space-y-3">
            <SendForm />
          </CardContent>
        </Card>
      </div>
    </div>
  </main>
</div>

); }

function SendForm() { const [to, setTo] = useState(""); const [text, setText] = useState(""); const [loading, setLoading] = useState(false); const submit = async () => { if (!to || !text) return; setLoading(true); try { const r = await fetch("/api/send", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ to, text }) }); const data = await r.json(); if (r.ok) toast.success("Pesan terkirim"); else toast.error(data?.error || "Gagal"); } catch (e) { toast.error("Error network"); } finally { setLoading(false); } }; return ( <div className="space-y-2"> <div className="grid gap-2"> <Label>Ke (JID)</Label> <Input placeholder="62812xxxxxxx@s.whatsapp.net" value={to} onChange={(e)=>setTo(e.target.value)} /> </div> <div className="grid gap-2"> <Label>Pesan</Label> <Input placeholder="Halo ini pesan uji (aman)" value={text} onChange={(e)=>setText(e.target.value)} /> </div> <div className="flex justify-end"> <Button disabled={loading} onClick={submit}><Send className="h-4 w-4 mr-1"/>Kirim</Button> </div> </div> ); }